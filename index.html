<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Birkenhead Rolling Wheels – Hagley Museum</title>
</head>

<body>

<h1>Birkenhead Rolling Wheels</h1>

<img src="test.jpg" width="600" alt="Birkenhead Rolling Wheels">

<script>
alert("QR script loaded");
</script>

<p>
This exhibit highlights the historical use of rolling wheels in the Birkenhead area and their role in early industrial processes.
</p>

<script>

/* =========================
CONFIG
========================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzm0wgH5Tdlz8KEGJcXRE4jif9Rxn_Ma3Vf_Dn-RhwMbKAT1LnZvLIs0uM1gts01k6rIQ/exec";
const EXHIBIT_NAME = "Birkenhead Rolling Wheels";
const WEATHER_API_KEY = "e23c0a18cd0744e940f5020207c57793";

/* Hagley Museum fixed coordinates */
const LAT = 39.7496;
const LON = -75.6206;


/* =========================
SEND SCAN TO APPS SCRIPT
========================= */
function sendScan(weatherType, temperature){

  const payload = {
    exhibit: EXHIBIT_NAME,
    weather: weatherType,
    temperature: temperature
  };

  console.log("Sending:", payload);

  fetch(SCRIPT_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  });

}


/* =========================
GET WEATHER FROM OPENWEATHER
========================= */
function logScan(){

  const weatherURL =
  `https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&units=imperial&appid=${WEATHER_API_KEY}`;

  console.log("Requesting weather:", weatherURL);

  fetch(weatherURL)
  .then(response => {

    if(!response.ok){
      throw new Error("Weather request failed with status " + response.status);
    }

    return response.json();
  })
  .then(data => {

    console.log("Weather data:", data);

    // Validate structure
    if(!data.main || !data.weather || !data.weather.length){
      throw new Error("Weather response missing fields");
    }

    // ✅ ONLY CHANGE: add °F here
    const temperature = Math.round(data.main.temp) + "°F";
    const weatherType = data.weather[0].description;

    sendScan(weatherType, temperature);

  })
  .catch(error => {

    console.error("Weather error:", error);

    // still log scan but mark weather error clearly
    sendScan("WEATHER_ERROR", "-1°F");

  });

}


/* =========================
RUN WHEN PAGE LOADS
========================= */
logScan();

</script>
</body>
</html>
